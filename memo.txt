

2016-09-15

* bug 一文字余分に消して追加するという結果になっている。

  例えば以下のような変更に対して差分を適用すると、
  何故か一文字だけ余分に消して追加するという形になってしまう。

  -hello world
  +hello

  アルゴリズムの側に誤りがあると思われるが、
  そうではなくて着色の側に誤りがある可能性もある。

* diff3 の着色

  マージに関する hank の時には元になるファイルが二つあって、
  結果が一つ存在する。この時 hank header が
  @@@ .... @@@
  という形になって、内容の各行は 1 文字目が一つ目のファイルからの変更で、
  2 文字目が二つ目のファイルからの変更で、それ以降が行の内容という形になっている。
  前回の hank header の種類を記録しておいてそれに応じて差分業の特定の仕方を切り替えられる様にする。
  またどの様な種類の行があるかについて可能性を調べておく。
  merge conflict 時に見た時には次の5種類が見られた: "  " 変更なし, " -", " +", "- ", "+ "

* 2016-09-07

  単語ごとに区切ってから diff をするのを実装してみたが、思う様に行かない。
  単語の skip に対するコストが小さすぎる。

  現在の実装では単語を /[_[:alnum:]]+|[[:blank:]]+|./ にしている。
  例えば "hello++" は "hello" "+" "+" に分割される。
  ここで diff "hello++" vs "++hello" を考えると、
  「hello が先頭から消されて hello が末尾に追加された」という結果になる。
  その方が変更される単語の数が少なくなるからである。
  しかし文字数にして考えてみれば "++" を消して "++" を追加した方が自然である。

  これを解決するためには、

  a. 以前通り文字ごとの diff でありながら compare を工夫する
    これだと、計算時間の短縮にはならないだろう。

  b. 矢張り単語ごとの diff にするが、重み付きの diff を可能にする。

    重みに対応するとなると単に p が少なければ良いという訳ではないので、
    ループの回し方を考えなおす必要がある。
    更に yskip の重みと xskip の重みも異なる事に注意する。

